# Optimal_routes_on_graphs_for_groups
# Оптимизация маршрутов группы в условиях угроз

## Описание задачи

Проект решает задачу оптимизации маршрута группы через территорию с распределенными угрозами.

### Цели
1. **Определение оптимальной численности группы** для прохождения территории
2. **Построение оптимального маршрута** с учетом расположения угроз
3. **Распределение численности подгрупп** в каждой точке маршрута

## Начальные данные

- **Координаты угроз** - расположение источников опасности на территории
- **Точки входа и выхода** - начальная и конечная точки маршрута группы
- **Вероятности поражения** - вероятности воздействия угрозы в различных точках территории

## Пайплайн решения

### 1. **Триангуляция территории**
Территория разбивается на сектора с помощью триангуляции Делоне по точкам расположения угроз:

<img width="686" height="567" alt="Триангуляция территории" src="https://github.com/user-attachments/assets/ac75df16-44a0-4191-80d6-7d1bae5f384d">

### 2. **Определение точек посещения**
Барицентры полученных треугольников определяются как точки обязательного посещения **A<sub>i</sub>**, добавляются точки входа и выхода(I, O):

<img width="678" height="480" alt="Точки посещения" src="https://github.com/user-attachments/assets/8cf5b029-03ce-4447-a980-aafc8c368e13">

### 3. **Генерация возможных маршрутов**
Для данной конфигурации точек генерируются все возможные маршруты (всего 104 варианта для данной карты):

<img width="833" height="645" alt="Все возможные маршруты" src="https://github.com/user-attachments/assets/70b3df7e-3b63-4aed-90e8-492275183d20">

### 4. **Оптимизация маршрута**
Для каждого маршрута решается задача оптимизации:
- В каждой промежуточной точке **A<sub>i</sub>** есть вероятность **p<sub>i</sub>** продолжения движения БПЛА
- Ограничения: численность подгруппы в каждой точке > 1
- условие: минимизация потерь

**Пример решения**: при вероятности 0.5 в каждой точке оптимальным оказывается маршрут №3 с начальной численностью 16 и потерями 15:

<img width="678" height="480" alt="Оптимальный маршрут" src="https://github.com/user-attachments/assets/75f1dd81-871a-47fd-afca-48294e62df1a">

## Статистический анализ

### Распределение оптимальных маршрутов
Для 100,000 случайных векторов вероятностей получено следующее распределение оптимальных маршрутов:

<img width="589" height="432" alt="Статистика маршрутов" src="https://github.com/user-attachments/assets/3575f36a-1480-49d4-8691-9803a5f97a68">

### Наблюдения:
- **Неравномерное распределение**: только 21 из 104 возможных маршрутов оказались оптимальными хоть раз
- **Редкие маршруты**: маршрут №86 был оптимальным всего 2 раза
- **Доминирующие маршруты**: небольшое количество маршрутов преобладает в решениях

<img width="678" height="480" alt="Распределение маршрутов" src="https://github.com/user-attachments/assets/32b74091-5d09-49df-9a1c-2a16b82deabc">

## Машинное обучение

### Обучение XGBoost
Несмотря на неравномерное распределение данных, была предпринята попытка обучения модели XGBoost для предсказания оптимального маршрута по векторам вероятностей.

### Метрики модели:
| Метрика | Значение | Интерпретация |
|---------|----------|---------------|
| **Micro-average F1** | 0.8134 | Высокая общая точность предсказаний |
| **Macro-average F1** | 0.5513 | Умеренное качество на минорных классах |
| **Weighted F1** | 0.8278 | Отличное качество с учетом весов классов |


### Модель XGBoost с балансировкой классов:
```python
sample_weights = compute_sample_weight('balanced', y_train_xgb)

model_xgb = XGBClassifier(
    n_estimators=200,
    learning_rate=0.05,
    max_depth=6,
    objective='multi:softprob',
    num_class=len(freq_dict_xgb),
    eval_metric='mlogloss',
    random_state=42
)

model_xgb.fit(X_train_xgb, y_train_xgb, sample_weight=sample_weights)
```
